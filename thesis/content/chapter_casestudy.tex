\chapter{Mini Case-Study}
\label{chapter:MiniCaseStudy}
This chapter provides a mini case-study evaluating the developed recovery system for this thesis.
§\ref{section:ExampleCorpus} outlines the corpus used for evaluation.
§\ref{section:Metrics} describes metrics used to evaluate the system.
§\ref{section:Results} discusses results of the case-study.

\section{Corpus}
\label{section:ExampleCorpus}
The example corpus used to develop the recovery system for this thesis consists of artifacts implementing a fictional \gls{HRMS} within an \gls{O/R/X-Mapping} scenario using \gls{Java} technologies.
The model is provided by the 101wiki\footnote{\url{https://101wiki.softlang.org/} (retrieved \formatdate{12}{11}{2017})}, where it is used for contributions.
It is implemented using plain \Gls{Java} and then mapped to plain \gls{XML}/\gls{XSD} with \gls{JAXB} and to \gls{SQL/DDL} statements using \gls{Hibernate} mapping files and/or annotations.



\subsection{The 101HRMS Model}
\gls{101HRMS}\footnote{\url{https://101wiki.softlang.org/101:@system} (retrieved \formatdate{12}{11}{2017})} provides a simple model of a company with many departments and employees.
Figure \ref{figure:101HRMSModel} shows an \gls{UML} class diagram of a variant of this model.

\begin{figure}[h!]
\begin{center}
\includegraphics[scale=.5]{images/101HRMSModel.png}
\end{center}
{
\scriptsize 
This \gls{UML} class diagram depicts the model of the \gls{101HRMS}.
It consists of simple companies with nested departments and employees mapped to the latter.
}
\caption{The 101 Human Resource Management System Model}
\label{figure:101HRMSModel}
\end{figure}

The \gls{101HRMS} model consists of companies attributed with a name.
Each company accumulates departments.
Each department is also attributed with a name, aggregates employees and has one employee acting as manager.
Departments can further be refined into sub-departments.
Each employee is attributed with a name, an age and a salary.
Each entity is also attributed with an ID.

\subsection{Linguistic Domains of the Example Corpus}
The example corpus used to develop the recovery system contains artifacts implementing the \gls{101HRMS} model generated or used by \gls{Java} technologies for \gls{O/R/X-Mapping}, i.e. a \gls{Java} model is mapped to plain \gls{XML}/\gls{XSD} with \gls{JAXB}, to a \gls{Hibernate} mapping file and to \gls{SQL}/\gls{DDL} statements.
Figure \ref{figure:ExampleCorpusJORXDomains} shows a schematic illustration of the linguistic domains involved:
\begin{description}

\item[Java]
The language and technology used to implement the \gls{101HRMS} model.

\item[XML]
The language used to serialize the \gls{101HRMS} model.

\item[SQL/DDL]
The language used to persist the \gls{101HRMS} model.

\item[JAXB]
The technology used to implement \gls{O/X-Mapping} of the \gls{101HRMS} model.

\item[Hibernate]
The technology used to implement \gls{O/R-Mapping} of the \gls{101HRMS} model.

\end{description}

\begin{figure}[h!]
\begin{center}
\includegraphics[width=.6\textwidth]{images/JORXDomains.png}
\end{center}
{
\scriptsize 
This schematic illustration depicts the interrelation among linguistic domains of example corpus used.
It depicts languages and technologies for \gls{O/R/X-Mapping} with \gls{Java}.
}
\caption{Example Corpus Domains: Java O/R/X}
\label{figure:ExampleCorpusJORXDomains}
\end{figure}

The languages (\gls{Java}, \gls{XML} \& \gls{SQL}) in Figure \ref{figure:ExampleCorpusJORXDomains} are displayed as disjoint square sets.
Technologies (\gls{JAXB} \& \gls{Hibernate}) are displayed as oval sets intersecting languages.
This is due to their linguistic nature, e.g. \gls{JAXB} produces specific \Gls{Java}- and \gls{XML}-Code which does not necessarily intersect with code produced by other technologies.
\gls{Hibernate} intersects all three languages.
It uses \gls{XML} files or \gls{Java}-Annotations for describing \gls{O/R-Mapping} of a data-model and generates \gls{SQL} artifacts according to that mapping.
In this sense, technologies create technology-specific subsets of a languages.

\section{Metrics}
\label{section:Metrics}
We evaluate the implemented recovery system regarding the requirements stated in §\ref{section:Requirements}, i.e. requirements \ref{requirement:FragmentRecovery}, \ref{requirement:ParthoodRecovery}, \ref{requirement:CorrespondenceRecovery} and \ref{requirement:ConformanceRecovery} for recovery of \gls{Parthood}, \glspl{Fragment}, \gls{Correspondence} links and \gls{Conformance} links.

For this, we measure the quantity of all entities of concern grouped by type, i.e. \glspl{Artifact}, files and \glspl{Fragment}:
\begin{align*}
\#\Artifact &:= |\{ x : \Artifact(x) \}| \\
\#\File &:= |\{ x : \File(x) \}| \\
\#\Fragment &:= |\{ x : \Fragment(x) \}|
\end{align*}
We also measure the overall amount of all relevant links grouped by type, i.e.
\partOf, \fragmentOf, \correspondsTo~ and \conformsTo:
\begin{align*}
\#\partOf &:= |\{ (x,y) : \partOf(x,y) \}| \\
\#\fragmentOf &:= |\{ (x,y) : \fragmentOf(x,y) \}| \\
\#\correspondsTo &:= |\{ (x,y) : \correspondsTo(x,y) \}| \\
\#\conformsTo &:= |\{ (x,y) : \conformsTo(x,y) \}| 
\end{align*}

For a more differentiated look on requirements \ref{requirement:FragmentRecovery} and \ref{requirement:ParthoodRecovery}, we measure the number of parts and \glspl{Fragment} of a specific entity:
\begin{align*}
\#\partOf(x) &:= |\{ y : \partOf(y,x) \}| \\
\#\fragmentOf(x) &:= |\{ y : \fragmentOf(y,x) \}| 
\end{align*}

\resizebox{\linewidth}{!}{
\begin{minipage}{\linewidth}
\begin{align*}
\#\correspondsTo(x,y) &:=
|\{ (x',y') : \correspondsTo(x',y') \wedge \fragmentOf(x',x) \wedge \fragmentOf(y',y)  \}|
\\
\#\correspondsTo_L(y) &:=
|\{ x : \correspondsTo(x,y') \wedge \fragmentOf(y',y)  \}|
\\
\#\correspondsTo_R(x) &:=
|\{ y : \correspondsTo(x',y) \wedge \fragmentOf(x',x)  \}|
\\
\#\conformsTo(x,y) &:=
|\{ (x',y') : \conformsTo(x',y') \wedge \fragmentOf(x',x) \wedge \fragmentOf(y',y)  \}|
\\
\#\conformsTo_L(y) &:=
|\{ x : \conformsTo(x,y') \wedge \fragmentOf(y',y)  \}|
\\
\#\conformsTo_R(x) &:=
|\{ y : \conformsTo(x',y) \wedge \fragmentOf(x',x)  \}|
\end{align*}
\end{minipage}
}

\section{Setup}
\label{section:Setup}
The implemented recovery system is evaluated with the \gls{Megamodel} shown in listing \ref{listing:EvaluatedMegamodel}.
\begin{lstlisting}[
caption={Evaluated Megamodel},
label={listing:EvaluatedMegamodel}]
companyJavaFile : File
companyJavaFile = 'workspace:/org.softlang.megal.plugins/input/Company.java'

companyHbmFile : File
companyHbmFile = 'workspace:/org.softlang.megal.plugins/input/Company.hbm.xml'

departmentJavaFile : File
departmentJavaFile = 'workspace:/org.softlang.megal.plugins/input/Department.java'

departmentHbmFile : File
departmentHbmFile = 'workspace:/org.softlang.megal.plugins/input/Department.hbm.xml'

employeeJavaFile : File
employeeJavaFile = 'workspace:/org.softlang.megal.plugins/input/Employee.java'

employeeHbmFile : File
employeeHbmFile = 'workspace:/org.softlang.megal.plugins/input/Employee.hbm.xml'

companiesXmlFile: File
companiesXmlFile = 'workspace:/org.softlang.megal.plugins/input/companies.xml'

companiesXsdFile: File
companiesXsdFile = 'workspace:/org.softlang.megal.plugins/input/companies.xsd'

comaniesSqlFile : File
comaniesSqlFile = 'workspace:/org.softlang.megal.plugins/input/companies.ddl.sql'

companyJavaFile correspondsTo companiesXsdFile
companyJavaFile correspondsTo comaniesSqlFile
companyJavaFile correspondsTo companyHbmFile

departmentJavaFile correspondsTo companiesXsdFile
departmentJavaFile correspondsTo comaniesSqlFile
departmentJavaFile correspondsTo departmentHbmFile

employeeJavaFile correspondsTo companiesXsdFile
employeeJavaFile correspondsTo comaniesSqlFile
employeeJavaFile correspondsTo employeeHbmFile

companiesXmlFile conformsTo companiesXsdFile
\end{lstlisting}
We declare nine \glspl{Artifact} to be files and bind them to locations on the local file system.
For each class of the \gls{101HRMS} model, i.e. company, department and employee, we declare a pair of entities comprising a \gls{Java} class file and a \gls{Hibernate} mapping file.
For the \gls{101HRMS} model at whole, \glspl{Artifact} for its \gls{XML}, \gls{XSD} and \gls{SQL/DDL} representations are declared.
Following this, we declare the expected \gls{Correspondence} and \gls{Conformance} relations among the files.

\section{Results}
\label{section:Results}
An evaluation of the setup described in §\ref{section:Setup} with the metrics of §\ref{section:Metrics} provides the following results.
Table \ref{table:NumberOfRecoveredArtifactsFilesAndFragments} shows the number of all \glspl{Artifact}, files and \glspl{Fragment} in the \gls{Megamodel} after execution.
\begin{table}[h!]
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
$\#\Artifact$ & $\#\File$ & $\#\Fragment$
\\ \hline
483 & 9 & 474 
\\ \hline
\end{tabular}
\end{center}
\caption{Number of recovered artifacts, files and fragments}
\label{table:NumberOfRecoveredArtifactsFilesAndFragments}
\end{table}
It indicates that files and \glspl{Fragment} are disjoint as proposed by axiom \ref{axiom:Fragment} in §\ref{section:AxiomsOfLinguisticArchitectures}.
All files and all fragments are artifacts, so their numbers sum up to the number of artifacts.
The number of files matches the given setup, the remaining \glspl{Artifact} are \glspl{Fragment}.

\begin{table}[h!]
\begin{center}
\begin{tabular}{|l|l|l|l|}
\hline
$\#\partOf$ & $\#\fragmentOf$ & $\#\correspondsTo$ & $\#\conformsTo$
\\ \hline
1847 & 1837 & 234 & 81 
\\ \hline
\end{tabular}
\end{center}
\caption{Number of recovered parthood, fragment, correspondence and conformance links}
\label{table:NumberOfRecoveredParthoodFragmentCorrespondenceAndConformanceLinks}
\end{table}

Table \ref{table:NumberOfPartsAndFragmentsPerFile} shows the number of recovered parts and \glspl{Fragment} per file. 
\begin{table}[h!]
\begin{center}
\begin{tabular}{|l|l|l|}
\hline
$x$ & $\#\partOf(x)$ & $\#\fragmentOf(x)$
\\ \hline
companyJavaFile & 9 & 9 
\\ \hline
companyHbmFile & 51 & 51 
\\ \hline
departmentJavaFile & 20 & 20 
\\ \hline
departmentHbmFile & 112 & 112 
\\ \hline
employeeJavaFile & 15 & 15 
\\ \hline
employeeHbmFile & 76 & 76 
\\ \hline
companiesXmlFile & 89 & 89 
\\ \hline
companiesXsdFile & 85 & 85 
\\ \hline
comaniesSqlFile & 17 & 17 
\\ \hline \hline
\textbf{Sum:} & 474 & 474 
\\ \hline 
\end{tabular}
\end{center}
\caption{Number of parts and fragments per file}
\label{table:NumberOfPartsAndFragmentsPerFile}
\end{table}
It indicates that all parts of each file are indeed proper parts (see §\ref{subsection:Fragments}).
Furthermore it indicates in conjunction with table \ref{table:NumberOfRecoveredArtifactsFilesAndFragments} that all recovered \glspl{Fragment} are properly linked to the files their originated from.



%\section{Link Proper Part Ratio}
%The ratio between all proper parts of two artifacts and the proper parts of the same artifacts in a relationship.
%
%\begin{align*}
%\pi_{R,A_1,A_2} = \frac{|\{ (p_1,p_2) \in R : p_1 \properPartOf A_1 \wedge p_2 \properPartOf A_2 \}|}{|\{ p : p \properPartOf A_1 \vee p \properPartOf A_2\}|}
%\end{align*}